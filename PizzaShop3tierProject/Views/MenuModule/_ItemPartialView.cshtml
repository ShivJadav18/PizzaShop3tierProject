@model PizzaShop.Repository.ViewModels.ItemsandCategories

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>


<div class="col-2 categories-list-sec">
    <div class="header d-flex justify-content-between align-items-center p-1">
        <h5 class="text-center Category">Category</h5>
        <div class="btn add-Category" data-bs-target="#AddCategory" data-bs-toggle="modal">
            <i class="fa fa-plus" aria-hidden="true"></i>
        </div>
        <div class="modal fade" id="AddCategory" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1"
            aria-labelledby="staticBackdropLabel" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content">
                    <div class="modal-header b-0">
                        <h5 class="modal-title" id="staticBackdropLabel">Add Category</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <form action="">
    using PizzaShop.Repository.ViewModels;
    using PizzaShop.Repository.Data;
                            <div class="form-floating mb-3">
                                <input type="text" class="form-control" id="Categoryname" placeholder="Category Name">
                                <label for="Categoryname">Name</label>
                            </div>
                            <div class="form-floating mb-3">
                                <input type="text" class="form-control" id="CategoryDescription"
                                    placeholder="Category Description">
                                <label for="CategoryDescription">Description</label>
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-nonprimary imp" id="Save-new-category">Save</button>
                        <button type="button" class="btn btn-nonsecondary no-imp"
                            data-bs-dismiss="modal">Cancle</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <nav class="sidebar overflow-auto" id="spc">
        <div class="list-group list-group-flush">
            @foreach (var category in Model.categories)
            {
                <div class="list-group-item list-group-item-action Categories d-flex justify-content-between align-items-center"
                    data-categoryid="@category.CategoryId">
                    <div class="d-flex align-items-center">
                        <i class="fa fa-th m-2" aria-hidden="true"></i>
                        @category.Categoryname
                    </div>
                    <div class="d-flex align-items-center d-none">                     
                        <i class="fa fa-pencil Edit-Category m-3" 
                            aria-hidden="true"></i>
                        <i class="fa fa-trash-o" id="delete-category-btn" data-bs-target="#delete-category-conf" data-bs-toggle="modal" aria-hidden="true"></i>
                    </div>
                </div>
            }
        </div>
    </nav>
    <div class="modal fade" id="EditCategory" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1"
        aria-labelledby="staticBackdropLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header b-0">
                    <h5 class="modal-title" id="staticBackdropLabel">Edit Category</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form action="">
                        <div class="form-floating mb-3">
                            <input type="text" class="form-control" id="CategoryEditname" placeholder="Category Name">
                            <label for="CategoryEditname">Name</label>
                        </div>
                        <div class="form-floating mb-3">
                            <input type="text" class="form-control" id="CategoryEditDescription"
                                placeholder="Category Description">
                            <label for="CategoryEditDescription">Description</label>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-nonprimary imp" id="Save-Edit-category">Save</button>
                    <button type="button" class="btn btn-nonsecondary no-imp" data-bs-dismiss="modal">Cancle</button>
                </div>
            </div>
        </div>
    </div>
    <div class="modal fade" id="delete-category-conf" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1"
            aria-labelledby="staticBackdropLabel" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="staticBackdropLabel">Delete Confirmation</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body text-center">
                        <img src="~/images/toppng.com-warning-icon-2400x2400.png" alt="warning" class="warning-img">
                        <p>Are you sure you want to delete this Category?</p>
                    </div>
                    <div class="modal-footer d-flex justify-content-center">
                        <button type="button" class="btn btn-nonsecondary imp" id="category-delete-btn" data-bs-dismiss="modal">Yes</button>
                        <button type="button" class="btn btn-nonprimary imp" data-bs-dismiss="modal">No</button>
                    </div>
                </div>
            </div>
        </div>
</div>
<div class="items-list-sec col" id="items-list-sec">
@await Html.PartialAsync("_Items",Model.itemmodel)
</div>
<script>
    $(document).ready(() => {

        $(".Categories").mouseenter(function () {
            $(this).children().last().removeClass("d-none");
            
        })


        $(".Categories").mouseleave(function () {
            $(this).children().last().addClass("d-none");
        })

        $("#Save-new-category").click(function (e) {
            e.preventDefault();

            var CategoryName = $("#Categoryname").val();
            var CategoryDescription = $("#CategoryDescription").val();

            if (CategoryName == "") {
                alert("Category name can not be Empty.");
            } else if (CategoryDescription == "") {
                alert("Category Description can not be Empty.");
            }

            $.ajax({
                url: "/MenuModule/AddCategory",
                type: "POST",
                data: {
                    Categoryname: CategoryName,
                    Description: CategoryDescription
                },
                success: (response) => {
                    if (response.success) {
                        alert(response.message);
                        window.location.reload();
                    } else {
                        alert(response.message);
                    }
                }
            })
        })      

        $(".Edit-Category").click( function (e) {
            var categoryid = e.target.closest(".Categories").dataset.categoryid; 
         
             $.ajax({
                url: "/MenuModule/EditCategory",
                data: {
                    categoryid: categoryid
                },
                success: (response) => {
                    if (response.success) {
                        $("#CategoryEditDescription").val(response.description);
                        $("#CategoryEditname").val(response.name);                        
                        $("#EditCategory").modal("show");
                    }
                }
            })
        })
    
    $("#Save-Edit-category").click((e) => {

        var name = $("#CategoryEditname").val();
        var description = $("#CategoryEditDescription").val();

        $.ajax({
            url : "/MenuModule/EditCategory",
            type : "POST",
            data : {
                categoryname : name,
                categorydescription : description
            },
            success : (response) => {
                if(response.success) {
                    alert(response.message);
                    window.location.reload();
                }
            }
        })

    })

    $("#category-delete-btn").click((e) => {
        var categoryid = $("#delete-category-btn").closest(".Categories").data("categoryid");

        $.ajax({
            url : "/MenuModule/DeleteCategory",
            data : {
                id : categoryid
            },
            success : (response) => {
                if(response.success) {
                    alert(response.message);
                    window.location.reload();
                }
            }
        })
    })

    $(".Categories").click(function () {
       
        var categoryid = $(this).data("categoryid");
        alert(categoryid);
        $.ajax({
            url : "/MenuModule/ItemsCategoryvise",
            type : "POST",
            data : {
                categoryid : categoryid
            },
            success : (data) => {
                alert();
                $("#items-list-sec").html(data);
            }
        })
    })

    })
     
</script>
