@model PizzaShop.Repository.ViewModels.Usertemp

@{
    ViewData["Title"] = "Create";
}

<script src="~/lib/jquery/dist/jquery.min.js"></script>

 <div class="content w-100" id="content">
                <div class="first-part d-flex justify-content-between m-1">
                    <h2>Edit User</h2>
                    <a href="/User/Userslist" class="btn btn-nonprimary imp">
                        <i class="fa fa-angle-left m-1" aria-hidden="true"></i>Back
                    </a>
                </div>
                <div class="add-user-form  m-2 p-2">
                    <form class="w-100 col" asp-action="Edit" asp-controller="User" asp-route-id="@Model.UserId"  method="post" enctype="multipart/form-data">
                        <input type="hidden" asp-for="UserId" name="UserId"/>
                        <input type="hidden" value="@Model.Email" name="Email">
                        <div class="row mb-3">
                            <div class="col">
                                <div class="form-floating">
                                <input type="text" asp-for="Firstname" class="form-control" id="floatingInput" placeholder="First Name" name="Firstname">
                                <label for="floatingInput">First Name</label>
                                </div>
                                <p class="validation-msg">@Html.ValidationMessageFor(model => model.Firstname)</p>
                            </div>
                            <div class="col">
                                <div class="form-floating">
                                <input type="text" asp-for="Lastname" class="form-control" placeholder="Last Name" name="Lastname"/>
                                <label for="floatingInput1">Last Name</label>
                                </div>
                                <p class="validation-msg">@Html.ValidationMessageFor(model => model.Lastname)</p>
                            </div>
                        </div>
                        <div class="row mb-3">
                            <div class="col">
                                <div class="form-floating">
                                <input type="email" class="form-control" asp-for="Email" id="floatingInput" placeholder="name@example.com" name="Email" disabled>
                                <label for="floatingInput">Email</label>
                                </div>
                                <p class="validation-msg">@Html.ValidationMessageFor(model => model.Email)</p>
                            </div>
                            <div class="dropdown col h-100">
                                <select class="form-select"class="h-100" asp-for="RoleId" aria-label="Default select example" name="RoleId">                       
                                    <option value="1">Super Admin</option>
                                    <option value="2">Account Manager</option>
                                    <option value="3">Chef</option>
                                </select>
                              </div>
                        </div>
                        <div class="row mb-3">
                            <div class="mb-3 col">
                                <div class="form-floating">
                                <input type="text" class="form-control" id="floatingInput" asp-for="Username" placeholder="User Name" name="Username">
                                <label for="floatingInput">User Name</label>
                                </div>
                                <p class="validation-msg">@Html.ValidationMessageFor(model => model.Username)</p>
                            </div>
                             <div class="dropdown col h-100">
                           <select class="form-select col h-100" asp-for="Status" aria-label="Default select example" name="Status">                       
                                    <option value="true">Active</option>
                                    <option value="false">Inactive</option>                                   
                            </select>
                             </div>
                        </div>
                        <div class="row">
                                    <p>Upload Image</p>
                                    <div class="col">
                                        <div class=" border-dashed rounded-1 text-center mb-3 mb-lg-0">
                                            <input type="file"  asp-for="UserImage" id="UserImage" accept="image/*" class="d-none">
                                             @{string imageurl = String.IsNullOrEmpty(Model.Imageurl)?Url.Content("~/images/Default_pfp.svg.png"): Url.Content("~/" + Model.Imageurl);
                    }
                                            <img src=@imageurl alt="profile-pic"
                                                id="UserImageShown" class="rounded-circle profile-info-pic m-2"
                                                height="80">
                                                <input type="hidden" asp-for="Imageurl">
                                            <label for="file" role="button" id="User-Image-input" class="py-5 w-100">
                                                Drag and
                                                Drop or Browse Files</label>
                                        </div>
                                        <p class="validation-msg"></p>
                                    </div>
                        </div>
                        <div class="row mb-3">
                            <div class="dropdown col">
                                 <select class="form-select"class="h-100" id="CountrySelect" asp-for="Country" aria-label="Default select example" name="Country">    
                                    <option value="@Model.Country" selected>@Model.Country</option>                                                              
                                </select>
                                <p class="validation-msg">@Html.ValidationMessageFor(model => model.Country)</p>
                              </div>
                              <div class="dropdown col">
                                 <select class="form-select" id="stateSelect" class="h-100" asp-for="State" aria-label="Default select example" name="State">       
                                    <option value="@Model.State" selected>@Model.State</option>                                                             
                                </select>
                                <p class="validation-msg">@Html.ValidationMessageFor(model => model.State)</p>
                              </div>
                              <div class="dropdown col">
                                 <select class="form-select"class="h-100" id="citySelect" asp-for="City" aria-label="Default select example" name="City">      
                                    <option value="@Model.City" selected>@Model.City</option>                             
                                </select>
                                <p class="validation-msg">@Html.ValidationMessageFor(model => model.City)</p>
                              </div>
                        </div>
                        <div class="row mb-5">
                            <div class="col">
                                <div class="form-floating">
                                <input type="text" class="form-control" asp-for="Zipcode" placeholder="Zipcode" name="Zipcode"/>
                                <label for="floatingInput1">Zipcode</label>
                                </div>
                                <p class="validation-msg">@Html.ValidationMessageFor(model => model.Zipcode)</p>
                            </div>
                            <div class="col">
                                <div class="form-floating">
                                <input type="text" class="form-control" asp-for="Address" placeholder="Address" name="Address"/>
                                <label for="floatingInput1">Address</label>
                                </div>
                                <p class="validation-msg">@Html.ValidationMessageFor(model => model.Address)</p>
                            </div>
                            <div class="col">
                                <div class="form-floating">
                                <input type="text" class="form-control" asp-for="Contactnumber" placeholder="Phone" name="Contactnumber"/>
                                <label for="floatingInput1">Phone</label>
                                </div>
                                <p class="validation-msg">@Html.ValidationMessageFor(model => model.Contactnumber)</p>
                            </div>
                        </div>
                        <div class="row w-100 align-items-center">
                            <button class="btn btn-nonprimary imp m-2" type="submit"><i class="fa fa-angle-left m-1" aria-hidden="true"></i>Edit User</button>
                            <button class="btn btn-nonprimary imp" id="Cancle"><i class="fa fa-angle-left m-1" aria-hidden="true"></i>Cancle</button>
                        </div>
                    </form>
                </div>

            </div>

            <script>
                $(document).ready(() => {
                let apiKey = "QVByWkJ5UWc1aWlXTUxZYW1KcVR5Q0p5cExuZGYyR2J2cWhqM000SA==";
                let apiBaseUrl = "https://api.countrystatecity.in/v1";

                $("#Cancle").on("click",(e) => {
                    e.preventDefault();
                    window.location = "/User/Userslist";
                })
                $("#User-Image-input").on("click", () => {
            $("#UserImage").click();
        })
        $("#UserImage").change(function (event) {
            let file = event.target.files[0];

            if (file) {
                let reader = new FileReader();
                reader.onload = function (e) {
                    $("#UserImageShown").attr("src", e.target.result); // Set preview
                };
                reader.readAsDataURL(file);

            }
        });
        // Load countries
        $.ajax({
            url: `${apiBaseUrl}/countries`,
            type: "GET",
            headers: { "X-CSCAPI-KEY": apiKey },
            success: function (countries) {
                let countrySelect = $("#CountrySelect");
                $.each(countries, function (index, country) {
                    countrySelect.append(`<option value="${country.name}" data-code="${country.iso2}">${country.name}</option>`);
                });
            },
            error: function () {
                alert("Error fetching countries.");
            }
        });

        $("#CountrySelect").change(function () {
            let countryName = $(this).val();
            let countryCode = $("#CountrySelect option:selected").attr("data-code"); // Get ISO2 Code
            $("#selectedCountry").val(countryName);

            if (countryCode) {
                $.ajax({
                    url: `${apiBaseUrl}/countries/${countryCode}/states`,
                    type: "GET",
                    headers: { "X-CSCAPI-KEY": apiKey },
                    success: function (states) {
                        let stateSelect = $("#stateSelect");
                        stateSelect.empty().append('<option selected>Select State</option>');
                        $.each(states, function (index, state) {
                            stateSelect.append(`<option value="${state.name}" data-code="${state.iso2}">${state.name}</option>`);
                        });
                        $("#citySelect").empty().append('<option selected>Select City</option>');
                    },
                    error: function () {
                        alert("Error fetching states.");
                    }
                });
            }
        });

         // Load cities when a state is selected
        $("#stateSelect").change(function () {
            let stateName = $(this).val();
            let stateCode = $("#stateSelect option:selected").attr("data-code");
            let countryCode = $("#CountrySelect option:selected").attr("data-code");
            $("#selectedState").val(stateName);

            if (countryCode && stateCode) {
                $.ajax({
                    url: `${apiBaseUrl}/countries/${countryCode}/states/${stateCode}/cities`,
                    type: "GET",
                    headers: { "X-CSCAPI-KEY": apiKey },
                    success: function (cities) {
                        let citySelect = $("#citySelect");
                        citySelect.empty().append('<option selected>Select City</option>');
                        $.each(cities, function (index, city) {
                            citySelect.append(`<option value="${city.name}">${city.name}</option>`);
                        });
                    },
                    error: function () {
                        alert("Error fetching cities.");
                    }
                });
            }
        });

        $("#citySelect").change(function () {
            $("#selectedCity").val($(this).val());
        });
                })
            </script>

@section Scripts {
    @{await Html.RenderPartialAsync("_ValidationScriptsPartial");}
}



