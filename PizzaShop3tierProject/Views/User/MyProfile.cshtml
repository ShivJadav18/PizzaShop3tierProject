@model PizzaShop.Repository.Data.User;


@{
    ViewData["Title"] = "Details";
     Layout="~/Views/Shared/_Layout.cshtml";
}


<script src="~/lib/jquery/dist/jquery.min.js"></script>
@* <div class="content w-100 m-2 p-2" id="content">
                <div class="first-part d-flex justify-content-between">
                    <h2>Users</h2>
                    <form class="d-flex">
                        <div class="form-group m-1">
                            <input type="text" class="form-control" placeholder="Search"/>
                        </div>
                        <a href="./adduser.html" class="btn btn-nonprimary m-1 imp">
                            Add User
                        </a>
                        <!-- <button class="btn btn-nonprimary m-1" id="adduser">Add User</button> -->
                    </form>
                </div>
                <div class="tbl m-2 d-flex flex-column ">
                    <table class="table" id="tbl">
                        <thead>
                            <th> @Html.DisplayNameFor(model => model.Firstname)</th>
                            <th>@Html.DisplayNameFor(model => model.Email)</th>
                            <th> @Html.DisplayNameFor(model => model.Contactnumber)</th>
                            <th> @Html.DisplayNameFor(model => model.Role)</th>
                            <th> @Html.DisplayNameFor(model => model.Status)</th>
                            <th>Action</th>
                        </thead>
                
                        <tr>
                            <td> @Html.DisplayFor(model => model.Username)</td>
                            <td> @Html.DisplayFor(model => model.Email)</td>
                            <td> @Html.DisplayFor(model => model.Contactnumber)</td>
                            <td> @Html.DisplayFor(model => model.Role.RoleId)</td>
                            <td>
                                <span class="badge rounded-pill bg-success w-50">Active</span>
                            </td>
                            <td>
                                <a href="./Edituser.html">
                                    <i class="fa fa-pencil mr-2" aria-hidden="true"></i>
                                </a>
                                <i class="fa fa-trash" aria-hidden="true" data-bs-toggle="modal" data-bs-target="#staticBackdrop"  data-bs-toggle="modal" data-bs-target="#staticBackdrop"></i>
                            </td>
                        </tr>
                        
                    </table>
                    <div class="modal fade" id="staticBackdrop" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
                        <div class="modal-dialog modal-dialog-centered">
                          <div class="modal-content">
                            <div class="modal-header">
                              <h5 class="modal-title" id="staticBackdropLabel">Delete Confirmation</h5>
                              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                            </div>
                            <div class="modal-body text-center">
                              <img src="./images/toppng.com-warning-icon-2400x2400.png" alt="warning" class="warning-img">
                              <p>Are you sure you want to delete this user?</p>
                            </div>
                            <div class="modal-footer d-flex justify-content-center">
                              <button type="button" class="btn btn-nonsecondary imp" data-bs-dismiss="modal">Yes</button>
                              <button type="button" class="btn btn-nonprimary no-imp">No</button>
                            </div>
                          </div>
                        </div>
                      </div>
                    <div class="d-flex justify-content-end">
                        <div class="dropdown d-flex justify-content-center align-items-center w-25">
                            <p class="w-50 text-center">Users per page</p>
                            <button class="w-25 btn btn-nonsecondary dropdown-toggle" type="button" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                              1
                            </button>
                            <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
                              <a class="dropdown-item" href="#">Action</a>
                              <a class="dropdown-item" href="#">Another action</a>
                              <a class="dropdown-item" href="#">Something else here</a>
                            </div>
                          </div>
                          <div class="paging d-flex justify-content-around align-items-center">
                              <button class="btn"><i class="fa fa-angle-left" aria-hidden="true"></i></button>
                            <button class="btn"><i class="fa fa-angle-right" aria-hidden="true"></i></button>
                          </div>
                    </div>
                    <script src="./temp.js"></script>
                </div>

            </div> *@

            <div class="content w-100" id="content">
                <div class="first-part d-flex justify-content-between">
                    <h2>My Profile</h2>
                </div>
                <div class="add-user-form  m-2">
                  <div class="background-profile w-100">
                      <img src="~/images/profile_div_bg.jpg" alt="backgroung-profile" class="h-100 w-100">
                  </div>
                  <div class="user-info d-flex justify-content-between align-items-center w-100 m-2 p-2">
                    <div class="d-flex">
                    <img src="~/images/Default_pfp.svg.png"  alt="profile-pic" id="imageShown" class="rounded-circle profile-info-pic m-2" height="90">
                    <i class="fa fa-camera" aria-hidden="true" id="camera-icon"></i>
                    <input type="file" class="d-none" id="image-input"/>
                      <div class="align-items-center ">
                        <h4>@Html.DisplayFor(model => model.Username)</h4>
                        <p id="role">@Html.DisplayFor(model => model.Role.Name)</p>
                      </div>
                    </div>
                    <p>@Html.DisplayFor(model => model.Email)</p>
                  </div>
                    <form class="col m-2" action="/User/MyProfile" method="post">
                    <input type="hidden" value="@Html.DisplayFor(model => model.Email)" name="Email">
                        <div class="row mb-3">
                            <div class="form-floating col">
                                <input type="text" class="form-control" name="Firstname" id="firstname" placeholder="First Name" value="@Html.DisplayFor(model => model.Firstname)"/>
                                 <label for="firstname">First Name</label> 
                            </div>
                            <div class="form-floating col">
                                <input type="text" class="form-control" name="Lastname" id="lastname" placeholder="Last Name" value="@Html.DisplayFor(model => model.Lastname)"/>
                                <label for="lastname">Last Name</label> 
                            </div>
                        </div>
                        <div class="row mb-3">
                            <div class="form-floating col">
                                <input type="text" class="form-control" name="Username" id="username" placeholder="User Name" value="@Html.DisplayFor(model => model.Username)"/>
                                <label for="username">User Name</label>
                            </div>
                            <div class="form-floating col ">
                                <input type="text" class="form-control"name="Contactnumber" id="phone" placeholder="Phone" value="@Html.DisplayFor(model => model.Contactnumber)"/>
                                <label for="phone">Phone</label> 
                            </div>
                        </div>
                        <div class="row mb-3">
                            <div class="row mb-3">
                            <div class="dropdown col">
                                 <select class="form-select"class="h-100" id="CountrySelect" asp-for="Country" aria-label="Default select example" name="Country">    
                                    <option value="@Model.Country" selected>@Model.Country</option>                                                              
                                </select>
                              </div>
                              <div class="dropdown col">
                                 <select class="form-select" id="stateSelect" class="h-100" asp-for="State" aria-label="Default select example" name="State">       
                                    <option value="@Model.State" selected>@Model.State</option>                                                             
                                </select>
                              </div>
                              <div class="dropdown col">
                                 <select class="form-select"class="h-100" id="citySelect" asp-for="City" aria-label="Default select example" name="City">      
                                    <option value="@Model.City" selected>@Model.City</option>                             
                                </select>
                              </div>
                        </div>
                        <div class="row mb-5">                          
                            <div class="form-floating col">
                              <textarea class="form-control" placeholder="Leave a comment here" name="Address" id="address">@Html.DisplayFor(model => model.Address)</textarea>
                              <label for="address">Address</label>
                            </div>
                            <div class="form-floating col-4">
                                <input type="text" class="form-control" id="zipcode" name="Zipcode" placeholder="Zipcode" value="@Html.DisplayFor(model => model.Zipcode)"/>
                                 <label for="zipcode">Zipcode</label> 
                            </div>
                        </div>
                        <div class="row w-100 align-items-center justify-content-end">
                            <button class="btn btn-nonprimary imp m-2" id="update" type="submit">Update</button>
                            <button class="btn btn-nonprimary imp" id="Cancle">Cancle</button>
                        </div>
                    </form>
                </div>

            </div>

            <script>
              $(document).ready(() => {
                var role = $("role");
                var updatebtn = $("#update");
                var canclebtn = $("#Cancle");

                var cameraicon = $("#camera-icon");
                var inputfieldimage = $("#image-input");

                cameraicon.on("click",(e) => {
                  inputfieldimage.click();
                });

                $("#image-input").change( function(event){
            let file = event.target.files[0];

            if (file) {
                let reader = new FileReader();
                reader.onload = function (e){
                    $("#imageShown").attr("src", e.target.result); // Set preview
                };
                reader.readAsDataURL(file);
                
            }
        });
                
                 let apiKey = "QVByWkJ5UWc1aWlXTUxZYW1KcVR5Q0p5cExuZGYyR2J2cWhqM000SA==";
                let apiBaseUrl = "https://api.countrystatecity.in/v1";

        // Load countries
        $.ajax({
            url: `${apiBaseUrl}/countries`,
            type: "GET",
            headers: { "X-CSCAPI-KEY": apiKey },
            success: function (countries) {
                let countrySelect = $("#CountrySelect");
                $.each(countries, function (index, country) {
                    countrySelect.append(`<option value="${country.name}" data-code="${country.iso2}">${country.name}</option>`);
                });
            },
            error: function () {
                alert("Error fetching countries.");
            }
        });

        $("#CountrySelect").change(function () {
            let countryName = $(this).val();
            let countryCode = $("#CountrySelect option:selected").attr("data-code"); // Get ISO2 Code
            $("#selectedCountry").val(countryName);

            if (countryCode) {
                $.ajax({
                    url: `${apiBaseUrl}/countries/${countryCode}/states`,
                    type: "GET",
                    headers: { "X-CSCAPI-KEY": apiKey },
                    success: function (states) {
                        let stateSelect = $("#stateSelect");
                        stateSelect.empty().append('<option selected>Select State</option>');
                        $.each(states, function (index, state) {
                            stateSelect.append(`<option value="${state.name}" data-code="${state.iso2}">${state.name}</option>`);
                        });
                        $("#citySelect").empty().append('<option selected>Select City</option>');
                    },
                    error: function () {
                        alert("Error fetching states.");
                    }
                });
            }
        });

         // Load cities when a state is selected
        $("#stateSelect").change(function () {
            let stateName = $(this).val();
            let stateCode = $("#stateSelect option:selected").attr("data-code");
            let countryCode = $("#CountrySelect option:selected").attr("data-code");
            $("#selectedState").val(stateName);

            if (countryCode && stateCode) {
                $.ajax({
                    url: `${apiBaseUrl}/countries/${countryCode}/states/${stateCode}/cities`,
                    type: "GET",
                    headers: { "X-CSCAPI-KEY": apiKey },
                    success: function (cities) {
                        let citySelect = $("#citySelect");
                        citySelect.empty().append('<option selected>Select City</option>');
                        $.each(cities, function (index, city) {
                            citySelect.append(`<option value="${city.name}">${city.name}</option>`);
                        });
                    },
                    error: function () {
                        alert("Error fetching cities.");
                    }
                });
            }
        });

        $("#citySelect").change(function () {
            $("#selectedCity").val($(this).val());
        });
               

              })
            </script>

