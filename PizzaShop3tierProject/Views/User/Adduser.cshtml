@model PizzaShop.Repository.ViewModels.NewUserModel

@{
    ViewData["Title"] = "Create";
}

<script src="~/lib/jquery/dist/jquery.min.js"></script>

 <div class="content w-100" id="content">
                <div class="first-part d-flex justify-content-between m-1">
                    <h2>Add User</h2>
                    <a href="/User/Userslist" class="btn btn-nonprimary imp">
                        <i class="fa fa-angle-left m-1" aria-hidden="true"></i>Back
                    </a>
                </div>
                <div class="add-user-form  m-2 p-2">
                    <form class="w-100 col" action="/User/Adduser" method="post" enctype="multipart/form-data">
                        <div class="row mb-3">
                            <div class="col">
                                <div class="form-floating">
                                <input type="text" class="form-control" asp-for="Firstname" id="Firstname" placeholder="First Name" name="Firstname" required>
                                <label for="Firstname">First Name</label>
                                </div>
                                <p class="validation-msg">@Html.ValidationMessageFor(Model => Model.Firstname)</p>
                            </div>
                            <div class="col">
                                <div class="form-floating">
                                <input type="text" class="form-control" id="Lastname" asp-for="Lastname" placeholder="Last Name" name="Lastname" required/>
                                <label for="Lastname">Last Name</label>
                                </div>
                                <p class="validation-msg">@Html.ValidationMessageFor(Model => Model.Lastname)</p>
                            </div>
                        </div>
                        <div class="row mb-3">
                            <div class="col">
                                <div class="form-floating">
                                <input type="email" class="form-control" id="Email" asp-for="Email" placeholder="name@example.com" name="Email" required>
                                <label for="Email">Email</label>
                                </div>
                                <p class="validation-msg">@Html.ValidationMessageFor(Model => Model.Email)</p>
                            </div>
                            <div class="dropdown col h-100">
                                <select class="form-select" aria-label="Default select example" name="RoleId" required>                       
                                    <option value="1">Super Admin</option>
                                    <option value="2">Account Manager</option>
                                    <option value="3">Chef</option>
                                </select>
                            </div>
                        </div>
                        <div class="row mb-3">
                            <div class="mb-3 col">
                                <div class="form-floating">
                                <input type="text" class="form-control" id="floatingInput" asp-for="Username" placeholder="User Name" name="Username" required>
                                <label for="floatingInput">User Name</label>
                                </div>
                            <p class="validation-msg">@Html.ValidationMessageFor(Model => Model.Username)</p>
                            </div>
                            <div class="mb-3 col">
                                <div class="form-floating">
                                <input type="password" class="form-control" id="floatingInput" asp-for="Password" placeholder="Password" name="Password" required>
                                <label for="floatingInput">Password</label>
                                </div>
                                <p class="validation-msg">@Html.ValidationMessageFor(Model => Model.Password)</p>
                            </div>
                        </div>
                       <div class="row">
                                    <p>Upload Image</p>
                                    <div class="col">
                                        <div class=" border-dashed rounded-1 text-center mb-3 mb-lg-0">
                                            <input type="file" name="UserImage" id="UserImage" class="d-none">
                                            <img src="~/images/Default_pfp.svg.png" alt="profile-pic"
                                                id="UserImageShown" class="rounded-circle profile-info-pic m-2"
                                                height="80">
                                                <input type="hidden" asp-for="Imageurl">
                                            <label for="file" role="button" id="User-Image-input" class="py-5 w-100">
                                                Drag and
                                                Drop or Browse Files</label>
                                        </div>
                                        <p class="validation-msg"></p>
                                    </div>
                        </div>
                        <div class="row mb-3">
                            <div class="dropdown col">
                                 <select class="form-select"class="h-100" id="CountrySelect" asp-for="Country" aria-label="Default select example" name="Country" required>                                                                  
                                </select>
                                <p class="validation-msg">@Html.ValidationMessageFor(Model => Model.Country)</p>
                              </div>
                              <div class="dropdown col">
                                 <select class="form-select" id="stateSelect" class="h-100" asp-for="State" aria-label="Default select example" name="State" required>                                                                   
                                </select>
                                <p class="validation-msg">@Html.ValidationMessageFor(Model => Model.State)</p>
                              </div>
                              <div class="dropdown col">
                                 <select class="form-select"class="h-100" id="citySelect" asp-for="City" aria-label="Default select example" name="City" required>                                  
                                </select>
                                <p class="validation-msg">@Html.ValidationMessageFor(Model => Model.City)</p>
                              </div>
                        </div>
                        <div class="row mb-5">
                            <div class="col">
                                <div class="form-floating">
                                <input type="text" class="form-control" placeholder="Zipcode" asp-for="Zipcode" name="Zipcode" required/>
                                <label for="floatingInput1">Zipcode</label>
                                </div>
                                <p class="validation-msg">@Html.ValidationMessageFor(Model => Model.Zipcode)</p>
                            </div>
                            <div class="col">
                                <div class="form-floating">
                                <input type="text" class="form-control" placeholder="Address" asp-for="Address" name="Address" required/>
                                <label for="floatingInput1">Address</label>
                                </div>
                                <p class="validation-msg">@Html.ValidationMessageFor(Model => Model.Address)</p>
                            </div>
                            <div class="col">
                                <div class="form-floating">
                                <input type="text" class="form-control" placeholder="Phone" asp-for="Contactnumber" name="Contactnumber" required/>
                                <label for="floatingInput1">Phone</label>
                                </div>
                                <p class="validation-msg">@Html.ValidationMessageFor(Model => Model.Contactnumber)</p>
                            </div>
                        </div>
                        <div class="row w-100 align-items-center">
                            <button class="btn btn-nonprimary imp m-2" type="submit"><i class="fa fa-angle-left m-1" aria-hidden="true"></i>Create User</button>
                            <button class="btn btn-nonprimary imp" id="Cancle"><i class="fa fa-angle-left m-1" aria-hidden="true"></i>Cancle</button>
                        </div>
                    </form>
                </div>

            </div>

            <script>
                $(document).ready(() => {
                let apiKey = "QVByWkJ5UWc1aWlXTUxZYW1KcVR5Q0p5cExuZGYyR2J2cWhqM000SA==";
                let apiBaseUrl = "https://api.countrystatecity.in/v1";

                $("#Cancle").on("click",(e) => {
                    e.preventDefault();
                    window.location="/User/Userslist";
                })
            $("#User-Image-input").on("click", () => {
            $("#UserImage").click();
        })
        $("#UserImage").change(function (event) {
            let file = event.target.files[0];

            if (file) {
                let reader = new FileReader();
                reader.onload = function (e) {
                    $("#UserImageShown").attr("src", e.target.result); // Set preview
                };
                reader.readAsDataURL(file);

            }
        });
        // Load countries
        $.ajax({
            url: `${apiBaseUrl}/countries`,
            type: "GET",
            headers: { "X-CSCAPI-KEY": apiKey },
            success: function (countries) {
                let countrySelect = $("#CountrySelect");
                $.each(countries, function (index, country) {
                    countrySelect.append(`<option value="${country.name}" data-code="${country.iso2}">${country.name}</option>`);
                });
            },
            error: function () {
                alert("Error fetching countries.");
            }
        });

        $("#CountrySelect").change(function () {
            let countryName = $(this).val();
            let countryCode = $("#CountrySelect option:selected").attr("data-code"); // Get ISO2 Code
            $("#selectedCountry").val(countryName);

            if (countryCode) {
                $.ajax({
                    url: `${apiBaseUrl}/countries/${countryCode}/states`,
                    type: "GET",
                    headers: { "X-CSCAPI-KEY": apiKey },
                    success: function (states) {
                        let stateSelect = $("#stateSelect");
                        stateSelect.empty().append('<option selected>Select State</option>');
                        $.each(states, function (index, state) {
                            stateSelect.append(`<option value="${state.name}" data-code="${state.iso2}">${state.name}</option>`);
                        });
                        $("#citySelect").empty().append('<option selected>Select City</option>');
                    },
                    error: function () {
                        alert("Error fetching states.");
                    }
                });
            }
        });

         // Load cities when a state is selected
        $("#stateSelect").change(function () {
            let stateName = $(this).val();
            let stateCode = $("#stateSelect option:selected").attr("data-code");
            let countryCode = $("#CountrySelect option:selected").attr("data-code");
            $("#selectedState").val(stateName);

            if (countryCode && stateCode) {
                $.ajax({
                    url: `${apiBaseUrl}/countries/${countryCode}/states/${stateCode}/cities`,
                    type: "GET",
                    headers: { "X-CSCAPI-KEY": apiKey },
                    success: function (cities) {
                        let citySelect = $("#citySelect");
                        citySelect.empty().append('<option selected>Select City</option>');
                        $.each(cities, function (index, city) {
                            citySelect.append(`<option value="${city.name}">${city.name}</option>`);
                        });
                    },
                    error: function () {
                        alert("Error fetching cities.");
                    }
                });
            }
        });

        $("#citySelect").change(function () {
            $("#selectedCity").val($(this).val());
        });
                })
            </script>

@section Scripts {
    @{await Html.RenderPartialAsync("_ValidationScriptsPartial");}
}
