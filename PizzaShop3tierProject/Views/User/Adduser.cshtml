@model PizzaShop.Repository.Data.User

@{
    ViewData["Title"] = "Create";
}

<script src="~/lib/jquery/dist/jquery.min.js"></script>

 <div class="content w-100" id="content">
                <div class="first-part d-flex justify-content-between m-1">
                    <h2>Add User</h2>
                    <a href="/User/Userslist" class="btn btn-nonprimary imp">
                        <i class="fa fa-angle-left m-1" aria-hidden="true"></i>Back
                    </a>
                </div>
                <div class="add-user-form  m-2 p-2">
                    <form class="w-100 col" action="/User/Adduser" method="post">
                        <div class="row mb-3">
                            <div class="form-floating  col">
                                <input type="text" class="form-control" id="Firstname" placeholder="First Name" name="Firstname">
                                <label for="Firstname">First Name</label>
                            </div>
                            <div class="form-floating col">
                                <input type="text" class="form-control" id="Lastname" placeholder="Last Name" name="Lastname"/>
                                <label for="Lastname">Last Name</label>
                            </div>
                        </div>
                        <div class="row mb-3">
                            <div class="form-floating col">
                                <input type="email" class="form-control" id="Email" placeholder="name@example.com" name="Email">
                                <label for="Email">Email</label>
                            </div>
                            <div class="dropdown col h-100">
                                <select class="form-select" aria-label="Default select example" name="RoleId">                       
                                    <option value="1">Super Admin</option>
                                    <option value="2">Account Manager</option>
                                    <option value="3">Chef</option>
                                </select>
                            </div>
                        </div>
                        <div class="row mb-3">
                            <div class="form-floating mb-3 col">
                                <input type="text" class="form-control" id="floatingInput" placeholder="User Name" name="Username">
                                <label for="floatingInput">User Name</label>
                            </div>
                            <div class="form-floating mb-3 col">
                                <input type="password" class="form-control" id="floatingInput" placeholder="Password" name="Password">
                                <label for="floatingInput">Password</label>
                            </div>
                        </div>
                        <div class="w-100 mb-3 d-flex flex-column " id="upload">
                            <div class="d-flex flex-column align-items-center" id="upload-div">
                            <div id="cloud-upload">
                                <i class="fa fa-cloud-upload w-100 h-100" aria-hidden="true"></i>
                            </div>
                            <p class="upload-t">upload</p>
                            </div>
                            <input type="file" class="form-control w-100 h-100 p-0 " id="upload-in" name="Imageurl"/>
                        </div>
                        <div class="row mb-3">
                            <div class="dropdown col">
                                 <select class="form-select"class="h-100" id="CountrySelect" aria-label="Default select example" name="Country">                                                                  
                                </select>
                              </div>
                              <div class="dropdown col">
                                 <select class="form-select" id="stateSelect" class="h-100" aria-label="Default select example" name="State">                                                                   
                                </select>
                              </div>
                              <div class="dropdown col">
                                 <select class="form-select"class="h-100" id="citySelect" aria-label="Default select example" name="City">                                  
                                </select>
                              </div>
                        </div>
                        <div class="row mb-5">
                            <div class="form-floating col">
                                <input type="text" class="form-control p-3" placeholder="Zipcode" name="Zipcode"/>
                                <label for="floatingInput1">Zipcode</label>
                            </div>
                            <div class="form-floating col">
                                <input type="text" class="form-control p-3" placeholder="Address" name="Address"/>
                                <label for="floatingInput1">Address</label>
                            </div>
                            <div class="form-floating col">
                                <input type="text" class="form-control p-3" placeholder="Phone" name="Contactnumber"/>
                                <label for="floatingInput1">Phone</label>
                            </div>
                        </div>
                        <div class="row w-100 align-items-center">
                            <button class="btn btn-nonprimary imp m-2" type="submit"><i class="fa fa-angle-left m-1" aria-hidden="true"></i>Create User</button>
                            <button class="btn btn-nonprimary imp" id="Cancle"><i class="fa fa-angle-left m-1" aria-hidden="true"></i>Cancle</button>
                        </div>
                    </form>
                </div>

            </div>

            <script>
                $(document).ready(() => {
                let apiKey = "QVByWkJ5UWc1aWlXTUxZYW1KcVR5Q0p5cExuZGYyR2J2cWhqM000SA==";
                let apiBaseUrl = "https://api.countrystatecity.in/v1";

                $("#Cancle").on("click",(e) => {
                    e.preventDefault();
                    window.location="/User/Userslist";
                })

        // Load countries
        $.ajax({
            url: `${apiBaseUrl}/countries`,
            type: "GET",
            headers: { "X-CSCAPI-KEY": apiKey },
            success: function (countries) {
                let countrySelect = $("#CountrySelect");
                $.each(countries, function (index, country) {
                    countrySelect.append(`<option value="${country.name}" data-code="${country.iso2}">${country.name}</option>`);
                });
            },
            error: function () {
                alert("Error fetching countries.");
            }
        });

        $("#CountrySelect").change(function () {
            let countryName = $(this).val();
            let countryCode = $("#CountrySelect option:selected").attr("data-code"); // Get ISO2 Code
            $("#selectedCountry").val(countryName);

            if (countryCode) {
                $.ajax({
                    url: `${apiBaseUrl}/countries/${countryCode}/states`,
                    type: "GET",
                    headers: { "X-CSCAPI-KEY": apiKey },
                    success: function (states) {
                        let stateSelect = $("#stateSelect");
                        stateSelect.empty().append('<option selected>Select State</option>');
                        $.each(states, function (index, state) {
                            stateSelect.append(`<option value="${state.name}" data-code="${state.iso2}">${state.name}</option>`);
                        });
                        $("#citySelect").empty().append('<option selected>Select City</option>');
                    },
                    error: function () {
                        alert("Error fetching states.");
                    }
                });
            }
        });

         // Load cities when a state is selected
        $("#stateSelect").change(function () {
            let stateName = $(this).val();
            let stateCode = $("#stateSelect option:selected").attr("data-code");
            let countryCode = $("#CountrySelect option:selected").attr("data-code");
            $("#selectedState").val(stateName);

            if (countryCode && stateCode) {
                $.ajax({
                    url: `${apiBaseUrl}/countries/${countryCode}/states/${stateCode}/cities`,
                    type: "GET",
                    headers: { "X-CSCAPI-KEY": apiKey },
                    success: function (cities) {
                        let citySelect = $("#citySelect");
                        citySelect.empty().append('<option selected>Select City</option>');
                        $.each(cities, function (index, city) {
                            citySelect.append(`<option value="${city.name}">${city.name}</option>`);
                        });
                    },
                    error: function () {
                        alert("Error fetching cities.");
                    }
                });
            }
        });

        $("#citySelect").change(function () {
            $("#selectedCity").val($(this).val());
        });
                })
            </script>

@section Scripts {
    @{await Html.RenderPartialAsync("_ValidationScriptsPartial");}
}
